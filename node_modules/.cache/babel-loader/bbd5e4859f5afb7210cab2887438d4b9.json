{"ast":null,"code":"import { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nvar _jsxFileName = \"/Users/barco/Desktop/sites/tests/dnd-tests/test6/hue-stage/client/src/Set/set-controls.jsx\",\n    _s = $RefreshSig$();\n\nimport React, { useState, useContext } from 'react';\nimport styled from 'styled-components';\nimport { set } from './data';\nimport { bridge } from './bridge';\nimport { SetContext } from '../SetContext'; // play button\n// pause button\n// tempo\n// i.e. tempo = 140, beat happens at second measure (4 beats)\n// 1 measure has x beats\n// measure length in ms = /\n// tempo == beats in 60s\n\nlet tempo = 120;\nlet beatsPerMeasure = 4;\nlet beatValue = 4; // 1/4 (quarter)\n// get current time and every 50 ms check what objects have a play time before current time\n// after copying state and sending, delete those objects from the play time\n// render all states \n// when rendering states, make an array with objects\n// each object will have two properties, playTime and an array of all the states\n//disable all controls and dnd interface\n\n/*\n\n\n*/\n\nconst SetControls = () => {\n  _s();\n\n  let {\n    globalSetData,\n    setGlobalSetData\n  } = useContext(SetContext);\n  console.log(globalSetData);\n  let stopButtonPressed = {\n    state: false\n  };\n  let [stopped, setStopped] = useState(false);\n  let [playing, setPlaying] = useState(false);\n  console.log(stopped);\n\n  const play = () => {\n    if (!playing) {\n      setPlaying(true);\n      let playerQueues = [];\n      set.map(light => {\n        let millisecondOcurrence = 0;\n        light.gridStates.map(state => {\n          let millisecondDuration = 60000 / tempo * beatsPerMeasure * state.duration;\n          playerQueues.push({\n            occurrenceTime: millisecondOcurrence,\n            properties: {\n              state: state,\n              bridgeIndex: light.bridgeIndex\n            }\n          });\n          millisecondOcurrence += millisecondDuration;\n        });\n      });\n      let startTime = new Date();\n      let player = setInterval(() => {\n        let currentTime = new Date();\n        let elapsedTime = currentTime - startTime;\n        let queueCopy = [...playerQueues];\n        let messages = queueCopy.filter(state => {\n          return state.occurrenceTime <= elapsedTime;\n        });\n        messages.map(message => {\n          bridge.send(message.properties.bridgeIndex, message.properties.state.data()); //console.log(message.properties.state, message.properties.bridgeIndex)\n        });\n        playerQueues = queueCopy.filter(state => state.occurrenceTime > elapsedTime);\n        console.log(stopButtonPressed.state);\n\n        if (playerQueues.length === 0 || stopButtonPressed.state) {\n          stopButtonPressed.state = false;\n          setPlaying(false);\n          setStopped(false);\n          clearInterval(player);\n        }\n      }, 50);\n    }\n  };\n\n  const stop = () => {\n    if (!stopped) {\n      stopButtonPressed.state = true;\n      setStopped(true);\n      console.log(stopped);\n      setPlaying(false);\n    }\n  };\n\n  const handleChange = e => {\n    if (e.target.name === \"tempo\") {\n      console.log(e.target.value);\n    }\n  };\n\n  return /*#__PURE__*/_jsxDEV(Controls, {\n    children: [/*#__PURE__*/_jsxDEV(Tempo, {\n      name: \"tempo\",\n      type: \"number\",\n      min: \"60\",\n      max: \"240\",\n      defaultValue: globalSetData === null || globalSetData === void 0 ? void 0 : globalSetData.tempo,\n      onChange: handleChange\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 144,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      children: [/*#__PURE__*/_jsxDEV(Play, {\n        playing: playing,\n        onClick: play,\n        children: \"\\uFE0E\\u25B6\\uFE0E\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 146,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(Stop, {\n        onClick: stop\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 147,\n        columnNumber: 17\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 145,\n      columnNumber: 13\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 137,\n    columnNumber: 9\n  }, this);\n};\n\n_s(SetControls, \"IEY7FsQkhe5plXJHY6NEQvzPcS4=\");\n\n_c = SetControls;\nexport default SetControls;\nconst Controls = styled.div`\n    color: white; \n    display: inline-flex;\n    float: center;\n    justify-content: center;\n    align-items: center;\n    border-radius: 15px;\n    background-color: #222;\n    margin: 5px;\n    & > * {\n        display: inline-flex;\n        justify-content: center;\n        align-items: center;\n    }\n`;\n_c2 = Controls;\nconst Play = styled.div`\n    width: 20px;\n    height: 20px;\n    margin: 20px;\n    font-size: 1.5rem;\n    cursor: pointer;\n    color: white;\n    :hover {\n        color: green;\n    }\n`;\n_c3 = Play;\nconst Stop = styled.div`\n    width: 20px;\n    height: 20px;\n    margin: 20px;\n    cursor: pointer;\n    background-color: white;\n    :hover {\n        background-color: red;\n    }\n    :active {\n        background-color: darkred;\n    }\n`;\n_c4 = Stop;\nconst Tempo = styled.input`\n    width: 50px;\n    height: 20px;\n    border: none;\n    color: white;\n    font-size: 1.3rem;\n    background-color: #222;\n    padding: 20px;\n    &:focus {\n        outline: none;\n    }\n`;\n_c5 = Tempo;\n\nvar _c, _c2, _c3, _c4, _c5;\n\n$RefreshReg$(_c, \"SetControls\");\n$RefreshReg$(_c2, \"Controls\");\n$RefreshReg$(_c3, \"Play\");\n$RefreshReg$(_c4, \"Stop\");\n$RefreshReg$(_c5, \"Tempo\");","map":{"version":3,"sources":["/Users/barco/Desktop/sites/tests/dnd-tests/test6/hue-stage/client/src/Set/set-controls.jsx"],"names":["React","useState","useContext","styled","set","bridge","SetContext","tempo","beatsPerMeasure","beatValue","SetControls","globalSetData","setGlobalSetData","console","log","stopButtonPressed","state","stopped","setStopped","playing","setPlaying","play","playerQueues","map","light","millisecondOcurrence","gridStates","millisecondDuration","duration","push","occurrenceTime","properties","bridgeIndex","startTime","Date","player","setInterval","currentTime","elapsedTime","queueCopy","messages","filter","message","send","data","length","clearInterval","stop","handleChange","e","target","name","value","Controls","div","Play","Stop","Tempo","input"],"mappings":"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","sourcesContent":["import React, {useState, useContext} from 'react';\nimport styled from 'styled-components';\nimport { set } from './data'\nimport { bridge } from './bridge'\nimport { SetContext } from '../SetContext';\n\n// play button\n// pause button\n// tempo\n\n// i.e. tempo = 140, beat happens at second measure (4 beats)\n\n// 1 measure has x beats\n// measure length in ms = /\n\n// tempo == beats in 60s\nlet tempo = 120;\nlet beatsPerMeasure = 4;\nlet beatValue = 4; // 1/4 (quarter)\n\n// get current time and every 50 ms check what objects have a play time before current time\n\n// after copying state and sending, delete those objects from the play time\n\n\n// render all states \n// when rendering states, make an array with objects\n// each object will have two properties, playTime and an array of all the states\n\n\n\n//disable all controls and dnd interface\n\n/*\n\n\n*/\n\nconst SetControls = () => {\n    \n    let {globalSetData, setGlobalSetData} = useContext(SetContext);\n\n    console.log(globalSetData);\n\n    let stopButtonPressed = {state: false};\n    let [stopped, setStopped] = useState(false);\n    let [playing, setPlaying] = useState(false);\n    console.log(stopped);\n    \n    const play = () => {\n\n        if(!playing) {\n\n            setPlaying(true);\n\n            let playerQueues = [];\n        \n            set.map(light => {\n\n                let millisecondOcurrence = 0;\n\n                light.gridStates.map(state => {\n\n                    let millisecondDuration = ((60000/tempo) * beatsPerMeasure) * state.duration\n                    \n                    playerQueues.push({\n                        occurrenceTime: millisecondOcurrence,\n                        properties: {\n                            state: state,\n                            bridgeIndex: light.bridgeIndex\n                        }\n                    })\n                    \n                    millisecondOcurrence += millisecondDuration;\n\n                })\n\n            })\n\n            let startTime = new Date()\n\n            let player = setInterval(()=>{\n\n                let currentTime = new Date()\n                let elapsedTime = currentTime - startTime;\n                let queueCopy = [...playerQueues]\n\n                let messages = queueCopy.filter(state => {\n                    return state.occurrenceTime <= elapsedTime\n                });\n\n                messages.map(message => {\n                    bridge.send(message.properties.bridgeIndex, message.properties.state.data())\n                    //console.log(message.properties.state, message.properties.bridgeIndex)\n                })\n                \n                playerQueues = queueCopy.filter(state => state.occurrenceTime > elapsedTime );\n\n\n                console.log(stopButtonPressed.state)\n\n                if(playerQueues.length === 0 || stopButtonPressed.state) {\n                    stopButtonPressed.state = false;\n                    setPlaying(false);\n                    setStopped(false);\n                    clearInterval(player);\n                }\n\n            }, 50)\n\n        } \n\n    }\n\n    const stop = () => {\n\n        if(!stopped) {\n\n            stopButtonPressed.state = true;\n            setStopped(true);\n            console.log(stopped)\n            setPlaying(false);\n        }\n\n    }\n\n    const handleChange = (e) => {\n        \n        if(e.target.name === \"tempo\") {\n            console.log(e.target.value);\n        }\n\n    }\n\n\n    return (\n        <Controls>\n            {\n                /* globalSetData.timeMethod === \"tempo\" ?\n                <Tempo></Tempo>\n                :\n                <></> */\n            }\n            <Tempo name=\"tempo\" type=\"number\" min=\"60\" max=\"240\" defaultValue={globalSetData?.tempo} onChange={handleChange}/>\n            <div>\n                <Play playing={playing} onClick={play}>&#xFE0E;&#9654;&#xFE0E;</Play>\n                <Stop onClick={stop}/>\n            </div>\n        </Controls>\n    );\n};\n\nexport default SetControls;\n\nconst Controls = styled.div`\n    color: white; \n    display: inline-flex;\n    float: center;\n    justify-content: center;\n    align-items: center;\n    border-radius: 15px;\n    background-color: #222;\n    margin: 5px;\n    & > * {\n        display: inline-flex;\n        justify-content: center;\n        align-items: center;\n    }\n`\n\nconst Play = styled.div`\n    width: 20px;\n    height: 20px;\n    margin: 20px;\n    font-size: 1.5rem;\n    cursor: pointer;\n    color: white;\n    :hover {\n        color: green;\n    }\n`\n\nconst Stop = styled.div`\n    width: 20px;\n    height: 20px;\n    margin: 20px;\n    cursor: pointer;\n    background-color: white;\n    :hover {\n        background-color: red;\n    }\n    :active {\n        background-color: darkred;\n    }\n`\n\nconst Tempo = styled.input`\n    width: 50px;\n    height: 20px;\n    border: none;\n    color: white;\n    font-size: 1.3rem;\n    background-color: #222;\n    padding: 20px;\n    &:focus {\n        outline: none;\n    }\n`"]},"metadata":{},"sourceType":"module"}